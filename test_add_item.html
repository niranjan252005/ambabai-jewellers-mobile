<!DOCTYPE html>
<html>
<head>
    <title>Test Jewelry App Features</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        button { background: #D4AF37; color: white; border: none; padding: 10px 20px; margin: 10px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #B8941F; }
        .test-section { background: #f9f9f9; padding: 20px; margin: 20px 0; border-radius: 10px; }
        .jewelry-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .jewelry-card { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; }
        .jewelry-card img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; }
        .no-image { width: 100%; height: 150px; background: #D4AF37; display: flex; align-items: center; justify-content: center; color: white; font-size: 2em; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üß™ Jewelry App Feature Tests</h1>
    
    <div class="test-section">
        <h2>üîß Admin Functions</h2>
        <button onclick="testAddItem()">‚ûï Test Add Item</button>
        <button onclick="loadJewelryItems()">üìã Load All Items</button>
        <button onclick="testImageZoom()">üîç Test Image Zoom</button>
    </div>
    
    <div id="result"></div>
    <div id="jewelry-container"></div>

    <script>
        async function testAddItem() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Testing add item...</p>';
            
            try {
                // Login first
                const loginResponse = await fetch('http://localhost:3000/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@jewelry.com',
                        password: 'admin123'
                    })
                });
                
                const loginData = await loginResponse.json();
                if (!loginResponse.ok) {
                    throw new Error('Login failed: ' + loginData.error);
                }
                
                // Add item
                const formData = new FormData();
                formData.append('name', 'Test Web Ring');
                formData.append('description', 'Test ring from web form');
                formData.append('price', '199.99');
                formData.append('category', 'Rings');
                formData.append('material', 'Gold');
                formData.append('weight', '3.5');
                formData.append('stock_quantity', '5');
                formData.append('brand', 'Test Brand');
                
                const addResponse = await fetch('http://localhost:3000/api/jewelry', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${loginData.token}`
                    },
                    body: formData
                });
                
                const addData = await addResponse.json();
                
                if (addResponse.ok) {
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; padding: 15px; border-radius: 5px; color: #155724;">
                            <h3>‚úÖ Add Item Success!</h3>
                            <p><strong>Message:</strong> ${addData.message}</p>
                            <p><strong>Item ID:</strong> ${addData.id}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #f8d7da; padding: 15px; border-radius: 5px; color: #721c24;">
                            <h3>‚ùå Add Item Failed</h3>
                            <p><strong>Error:</strong> ${addData.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; padding: 15px; border-radius: 5px; color: #721c24;">
                        <h3>‚ùå Network Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function testImageZoom() {
            showImageZoom('https://via.placeholder.com/600x600/D4AF37/FFFFFF?text=Test+Diamond+Ring', 'Test Diamond Ring');
            
            document.getElementById('result').innerHTML = `
                <div style="background: #d1ecf1; padding: 15px; border-radius: 5px; color: #0c5460;">
                    <h3>‚úÖ Image Zoom Test</h3>
                    <p>Image zoom overlay should be displayed. Click outside to close.</p>
                </div>
            `;
        }
        
        function showImageZoom(imageUrl, itemName) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            overlay.onclick = (e) => {
                if (e.target === overlay) {
                    document.body.removeChild(overlay);
                    document.body.style.overflow = 'auto';
                }
            };
            
            overlay.innerHTML = `
                <div style="position: relative; max-width: 90%; max-height: 90%;">
                    <button style="position: absolute; top: -50px; right: -20px; background: rgba(255, 255, 255, 0.2); border: none; color: white; font-size: 24px; padding: 10px; border-radius: 50%; cursor: pointer; z-index: 1001;" onclick="document.body.removeChild(this.parentElement.parentElement); document.body.style.overflow = 'auto';">√ó</button>
                    <img src="${imageUrl}" alt="${itemName}" style="max-width: 100%; max-height: 80vh; object-fit: contain; border-radius: 10px;">
                    <div style="position: absolute; bottom: -80px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.8); color: white; padding: 20px 30px; border-radius: 15px; text-align: center; min-width: 200px;">
                        <h3 style="margin: 0; color: #D4AF37; font-size: 20px;">${itemName}</h3>
                        <p style="margin: 8px 0 0 0; font-size: 14px; opacity: 0.8;">Click outside to close ‚Ä¢ Zoom and pan enabled</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            document.body.style.overflow = 'hidden';
        }
        
        async function loadJewelryItems() {
            const resultDiv = document.getElementById('result');
            const containerDiv = document.getElementById('jewelry-container');
            
            resultDiv.innerHTML = '<p>Loading jewelry items...</p>';
            
            try {
                // Login first
                const loginResponse = await fetch('http://localhost:3000/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'admin@jewelry.com',
                        password: 'admin123'
                    })
                });
                
                const loginData = await loginResponse.json();
                if (!loginResponse.ok) {
                    throw new Error('Login failed: ' + loginData.error);
                }
                
                // Get jewelry items
                const itemsResponse = await fetch('http://localhost:3000/api/jewelry', {
                    headers: {
                        'Authorization': `Bearer ${loginData.token}`
                    }
                });
                
                const items = await itemsResponse.json();
                
                if (itemsResponse.ok) {
                    resultDiv.innerHTML = `
                        <div style="background: #d4edda; padding: 15px; border-radius: 5px; color: #155724;">
                            <h3>‚úÖ Loaded ${items.length} jewelry items</h3>
                            <p>Click any item image to test zoom functionality</p>
                        </div>
                    `;
                    
                    // Display first 12 items
                    const displayItems = items.slice(0, 12);
                    containerDiv.innerHTML = `
                        <h3>Sample Jewelry Items (First 12 of ${items.length})</h3>
                        <div class="jewelry-grid">
                            ${displayItems.map(item => `
                                <div class="jewelry-card">
                                    ${item.image_url ? 
                                        `<img src="${item.image_url}" alt="${item.name}" onclick="showImageZoom('${item.image_url}', '${item.name}')">` : 
                                        `<div class="no-image" onclick="showImageZoom('https://via.placeholder.com/400x400/D4AF37/FFFFFF?text=${encodeURIComponent(item.name)}', '${item.name}')">üíé</div>`
                                    }
                                    <h4>${item.name}</h4>
                                    <p><strong>$${item.price}</strong> ‚Ä¢ ${item.material}</p>
                                    <p style="font-size: 12px; color: #666;">${item.category} ‚Ä¢ ${item.stock_quantity} in stock</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #f8d7da; padding: 15px; border-radius: 5px; color: #721c24;">
                            <h3>‚ùå Failed to load items</h3>
                            <p><strong>Error:</strong> ${items.error}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; padding: 15px; border-radius: 5px; color: #721c24;">
                        <h3>‚ùå Network Error</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>